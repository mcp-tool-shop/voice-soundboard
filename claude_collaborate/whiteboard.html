<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Whiteboard</title>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-toolbar: rgba(22, 27, 34, 0.95);
            --border: rgba(255,255,255,0.1);
            --text: #e6edf3;
            --text-dim: #8b949e;
            --accent: #58a6ff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }

        /* Canvas Container */
        .canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
            background:
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #whiteboard {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }

        /* Top Toolbar */
        .toolbar {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-toolbar);
            border: 1px solid var(--border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .tool-group {
            display: flex;
            gap: 4px;
            padding-right: 8px;
            border-right: 1px solid var(--border);
        }

        .tool-group:last-child {
            border-right: none;
            padding-right: 0;
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .tool-btn.active {
            background: var(--accent);
            color: #000;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .color-swatch {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.15);
        }

        .color-swatch.active {
            border-color: white;
            box-shadow: 0 0 10px currentColor;
        }

        /* Size Slider */
        .size-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .size-control input {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .size-control input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }

        .size-preview {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .size-dot {
            background: var(--text);
            border-radius: 50%;
        }

        /* Side Panel - Shapes */
        .shapes-panel {
            position: fixed;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: var(--bg-toolbar);
            border: 1px solid var(--border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .shape-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--text);
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shape-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .shape-btn.active {
            background: var(--accent);
            color: #000;
        }

        /* Bottom Info Bar */
        .info-bar {
            position: fixed;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            padding: 10px 20px;
            background: var(--bg-toolbar);
            border: 1px solid var(--border);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Zoom Controls */
        .zoom-controls {
            position: fixed;
            bottom: 16px;
            right: 16px;
            display: flex;
            gap: 4px;
            padding: 6px;
            background: var(--bg-toolbar);
            border: 1px solid var(--border);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .zoom-level {
            padding: 0 8px;
            display: flex;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-dim);
            min-width: 50px;
            justify-content: center;
        }

        /* Text Input Modal */
        .text-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .text-modal.active {
            display: flex;
        }

        .text-modal-content {
            background: var(--bg-toolbar);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            width: 400px;
        }

        .text-modal h3 {
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .text-modal textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            resize: none;
            margin-bottom: 12px;
        }

        .text-modal textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .text-modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .text-modal-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-cancel {
            background: rgba(255,255,255,0.1);
            color: var(--text);
        }

        .btn-add {
            background: var(--accent);
            color: #000;
        }

        /* Sticky Notes */
        .sticky-note {
            position: absolute;
            min-width: 150px;
            min-height: 100px;
            padding: 12px;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            cursor: move;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .sticky-note.yellow { background: #fef3c7; color: #92400e; }
        .sticky-note.pink { background: #fce7f3; color: #9d174d; }
        .sticky-note.blue { background: #dbeafe; color: #1e40af; }
        .sticky-note.green { background: #d1fae5; color: #065f46; }

        .sticky-note .delete-note {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border: none;
            background: rgba(0,0,0,0.2);
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.7rem;
        }

        .sticky-note:hover .delete-note {
            opacity: 1;
        }

        /* Title */
        .board-title {
            position: fixed;
            top: 16px;
            left: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            background: var(--bg-toolbar);
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <div class="board-title">Collaborative Whiteboard</div>

    <div class="canvas-container">
        <canvas id="whiteboard"></canvas>
    </div>

    <!-- Top Toolbar -->
    <div class="toolbar">
        <div class="tool-group">
            <button class="tool-btn active" data-tool="pen" title="Pen (P)">‚úèÔ∏è</button>
            <button class="tool-btn" data-tool="eraser" title="Eraser (E)">üßπ</button>
            <button class="tool-btn" data-tool="select" title="Select (V)">üëÜ</button>
        </div>

        <div class="tool-group color-picker">
            <div class="color-swatch active" data-color="#ffffff" style="background:#ffffff"></div>
            <div class="color-swatch" data-color="#ff6b6b" style="background:#ff6b6b"></div>
            <div class="color-swatch" data-color="#feca57" style="background:#feca57"></div>
            <div class="color-swatch" data-color="#48dbfb" style="background:#48dbfb"></div>
            <div class="color-swatch" data-color="#1dd1a1" style="background:#1dd1a1"></div>
            <div class="color-swatch" data-color="#ff9ff3" style="background:#ff9ff3"></div>
            <div class="color-swatch" data-color="#5f27cd" style="background:#5f27cd"></div>
        </div>

        <div class="tool-group size-control">
            <div class="size-preview">
                <div class="size-dot" id="size-dot"></div>
            </div>
            <input type="range" id="brush-size" min="1" max="30" value="4">
        </div>

        <div class="tool-group">
            <button class="tool-btn" id="undo-btn" title="Undo (Ctrl+Z)">‚Ü©Ô∏è</button>
            <button class="tool-btn" id="redo-btn" title="Redo (Ctrl+Y)">‚Ü™Ô∏è</button>
            <button class="tool-btn" id="clear-btn" title="Clear All">üóëÔ∏è</button>
        </div>
    </div>

    <!-- Side Shapes Panel -->
    <div class="shapes-panel">
        <button class="shape-btn" data-shape="line" title="Line">üìè</button>
        <button class="shape-btn" data-shape="rect" title="Rectangle">‚¨ú</button>
        <button class="shape-btn" data-shape="circle" title="Circle">‚≠ï</button>
        <button class="shape-btn" data-shape="arrow" title="Arrow">‚û°Ô∏è</button>
        <button class="shape-btn" data-shape="text" title="Text">üìù</button>
        <button class="shape-btn" data-shape="sticky" title="Sticky Note">üìå</button>
    </div>

    <!-- Bottom Info -->
    <div class="info-bar">
        <div class="info-item">
            <span>üñ±Ô∏è</span>
            <span id="cursor-pos">0, 0</span>
        </div>
        <div class="info-item">
            <span>üìê</span>
            <span id="stroke-count">0 strokes</span>
        </div>
        <div class="info-item">
            <span>üí°</span>
            <span>Hold Shift for straight lines</span>
        </div>
    </div>

    <!-- Zoom Controls -->
    <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-out">‚àí</button>
        <span class="zoom-level" id="zoom-level">100%</span>
        <button class="zoom-btn" id="zoom-in">+</button>
        <button class="zoom-btn" id="zoom-fit">‚ä°</button>
    </div>

    <!-- Text Input Modal -->
    <div class="text-modal" id="text-modal">
        <div class="text-modal-content">
            <h3>Add Text</h3>
            <textarea id="text-input" placeholder="Type your text here..."></textarea>
            <div class="text-modal-buttons">
                <button class="btn-cancel" onclick="closeTextModal()">Cancel</button>
                <button class="btn-add" onclick="addText()">Add</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');

        // State
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#ffffff';
        let brushSize = 4;
        let strokes = [];
        let currentStroke = [];
        let undoStack = [];
        let redoStack = [];
        let zoom = 1;
        let panX = 0, panY = 0;
        let startX, startY;
        let shapeMode = null;
        let textPosition = null;
        let stickyNotes = [];

        // Resize canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            redraw();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Drawing functions
        function startDrawing(e) {
            if (shapeMode === 'text') {
                textPosition = { x: e.clientX, y: e.clientY };
                document.getElementById('text-modal').classList.add('active');
                document.getElementById('text-input').focus();
                return;
            }

            if (shapeMode === 'sticky') {
                addStickyNote(e.clientX, e.clientY);
                return;
            }

            isDrawing = true;
            startX = e.clientX;
            startY = e.clientY;
            currentStroke = [{ x: startX, y: startY }];

            if (currentTool === 'pen' && !shapeMode) {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
            }
        }

        function draw(e) {
            // Update cursor position
            document.getElementById('cursor-pos').textContent = `${e.clientX}, ${e.clientY}`;

            if (!isDrawing) return;

            const x = e.clientX;
            const y = e.clientY;

            if (shapeMode) {
                // Preview shape
                redraw();
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';

                if (shapeMode === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    if (e.shiftKey) {
                        // Snap to 45 degree angles
                        const angle = Math.atan2(y - startY, x - startX);
                        const snapAngle = Math.round(angle / (Math.PI / 4)) * (Math.PI / 4);
                        const dist = Math.hypot(x - startX, y - startY);
                        ctx.lineTo(startX + Math.cos(snapAngle) * dist, startY + Math.sin(snapAngle) * dist);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                } else if (shapeMode === 'rect') {
                    ctx.strokeRect(startX, startY, x - startX, y - startY);
                } else if (shapeMode === 'circle') {
                    const radius = Math.hypot(x - startX, y - startY);
                    ctx.beginPath();
                    ctx.arc(startX, startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (shapeMode === 'arrow') {
                    drawArrow(startX, startY, x, y);
                }
            } else if (currentTool === 'pen') {
                ctx.lineTo(x, y);
                ctx.stroke();
                currentStroke.push({ x, y });
            } else if (currentTool === 'eraser') {
                ctx.save();
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, brushSize * 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        function stopDrawing(e) {
            if (!isDrawing) return;
            isDrawing = false;

            const x = e.clientX;
            const y = e.clientY;

            if (shapeMode) {
                // Save shape as stroke
                strokes.push({
                    type: shapeMode,
                    startX, startY,
                    endX: x, endY: y,
                    color: currentColor,
                    size: brushSize,
                    shift: e.shiftKey
                });
            } else if (currentTool === 'pen' && currentStroke.length > 1) {
                strokes.push({
                    type: 'pen',
                    points: [...currentStroke],
                    color: currentColor,
                    size: brushSize
                });
            }

            currentStroke = [];
            redoStack = [];
            updateStrokeCount();
        }

        function drawArrow(fromX, fromY, toX, toY) {
            const headLen = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLen * Math.cos(angle - Math.PI / 6), toY - headLen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLen * Math.cos(angle + Math.PI / 6), toY - headLen * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }

        function redraw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            strokes.forEach(stroke => {
                ctx.strokeStyle = stroke.color;
                ctx.lineWidth = stroke.size;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                if (stroke.type === 'pen') {
                    ctx.beginPath();
                    ctx.moveTo(stroke.points[0].x, stroke.points[0].y);
                    stroke.points.forEach(p => ctx.lineTo(p.x, p.y));
                    ctx.stroke();
                } else if (stroke.type === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(stroke.startX, stroke.startY);
                    ctx.lineTo(stroke.endX, stroke.endY);
                    ctx.stroke();
                } else if (stroke.type === 'rect') {
                    ctx.strokeRect(stroke.startX, stroke.startY, stroke.endX - stroke.startX, stroke.endY - stroke.startY);
                } else if (stroke.type === 'circle') {
                    const radius = Math.hypot(stroke.endX - stroke.startX, stroke.endY - stroke.startY);
                    ctx.beginPath();
                    ctx.arc(stroke.startX, stroke.startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (stroke.type === 'arrow') {
                    drawArrow(stroke.startX, stroke.startY, stroke.endX, stroke.endY);
                } else if (stroke.type === 'text') {
                    ctx.font = `${stroke.size * 4}px sans-serif`;
                    ctx.fillStyle = stroke.color;
                    ctx.fillText(stroke.text, stroke.x, stroke.y);
                }
            });
        }

        // Event listeners
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseleave', stopDrawing);

        // Tool selection
        document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTool = btn.dataset.tool;
                shapeMode = null;
                document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
            });
        });

        // Shape selection
        document.querySelectorAll('.shape-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                shapeMode = btn.dataset.shape;
                currentTool = 'shape';
            });
        });

        // Color selection
        document.querySelectorAll('.color-swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                swatch.classList.add('active');
                currentColor = swatch.dataset.color;
            });
        });

        // Brush size
        const brushSizeInput = document.getElementById('brush-size');
        const sizeDot = document.getElementById('size-dot');

        function updateSizeDot() {
            brushSize = parseInt(brushSizeInput.value);
            sizeDot.style.width = Math.min(brushSize, 20) + 'px';
            sizeDot.style.height = Math.min(brushSize, 20) + 'px';
        }
        brushSizeInput.addEventListener('input', updateSizeDot);
        updateSizeDot();

        // Undo/Redo
        document.getElementById('undo-btn').addEventListener('click', () => {
            if (strokes.length > 0) {
                redoStack.push(strokes.pop());
                redraw();
                updateStrokeCount();
            }
        });

        document.getElementById('redo-btn').addEventListener('click', () => {
            if (redoStack.length > 0) {
                strokes.push(redoStack.pop());
                redraw();
                updateStrokeCount();
            }
        });

        // Clear
        document.getElementById('clear-btn').addEventListener('click', () => {
            if (confirm('Clear the entire whiteboard?')) {
                strokes = [];
                redoStack = [];
                document.querySelectorAll('.sticky-note').forEach(n => n.remove());
                stickyNotes = [];
                redraw();
                updateStrokeCount();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                document.getElementById('undo-btn').click();
            } else if (e.ctrlKey && e.key === 'y') {
                e.preventDefault();
                document.getElementById('redo-btn').click();
            } else if (e.key === 'p') {
                document.querySelector('[data-tool="pen"]').click();
            } else if (e.key === 'e') {
                document.querySelector('[data-tool="eraser"]').click();
            } else if (e.key === 'v') {
                document.querySelector('[data-tool="select"]').click();
            }
        });

        // Text modal
        function closeTextModal() {
            document.getElementById('text-modal').classList.remove('active');
            document.getElementById('text-input').value = '';
            textPosition = null;
        }

        function addText() {
            const text = document.getElementById('text-input').value.trim();
            if (text && textPosition) {
                strokes.push({
                    type: 'text',
                    text,
                    x: textPosition.x,
                    y: textPosition.y,
                    color: currentColor,
                    size: brushSize
                });
                redraw();
                updateStrokeCount();
            }
            closeTextModal();
        }

        // Sticky notes
        const stickyColors = ['yellow', 'pink', 'blue', 'green'];
        let stickyColorIndex = 0;

        function addStickyNote(x, y) {
            const note = document.createElement('div');
            note.className = `sticky-note ${stickyColors[stickyColorIndex % stickyColors.length]}`;
            note.style.left = x + 'px';
            note.style.top = y + 'px';
            note.contentEditable = true;
            note.innerHTML = 'Click to edit...';

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-note';
            deleteBtn.textContent = '√ó';
            deleteBtn.onclick = () => note.remove();
            note.appendChild(deleteBtn);

            // Dragging
            let isDragging = false;
            let offsetX, offsetY;

            note.addEventListener('mousedown', (e) => {
                if (e.target === deleteBtn) return;
                isDragging = true;
                offsetX = e.clientX - note.offsetLeft;
                offsetY = e.clientY - note.offsetTop;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    note.style.left = (e.clientX - offsetX) + 'px';
                    note.style.top = (e.clientY - offsetY) + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            document.body.appendChild(note);
            stickyColorIndex++;
            note.focus();
        }

        // Zoom
        document.getElementById('zoom-in').addEventListener('click', () => {
            zoom = Math.min(zoom + 0.25, 3);
            updateZoom();
        });

        document.getElementById('zoom-out').addEventListener('click', () => {
            zoom = Math.max(zoom - 0.25, 0.25);
            updateZoom();
        });

        document.getElementById('zoom-fit').addEventListener('click', () => {
            zoom = 1;
            updateZoom();
        });

        function updateZoom() {
            document.getElementById('zoom-level').textContent = Math.round(zoom * 100) + '%';
            canvas.style.transform = `scale(${zoom})`;
            canvas.style.transformOrigin = 'center center';
        }

        function updateStrokeCount() {
            document.getElementById('stroke-count').textContent = `${strokes.length} strokes`;
        }

        // Initial setup
        updateStrokeCount();
    </script>
</body>
</html>
